# 安装配置

## 安装
```
wget http://www.keepalived.org/software/keepalived-1.3.5.tar.gz
tar zxf keepalived-1.3.5.tar.gz
cd keepalived-1.3.5/
yum install openssl-devel -y #可选操作
./configure --sysconf=/etc
make&&make install
cp /root/keepalived-1.3.5/keepalived/etc/init.d/keepalived  /etc/init.d 
chmod 755 /etc/init.d/keepalived
vim /etc/keepalived/keepalived.cof
vim /usr/lib/systemd/system/keepalived.service #去掉两个多余的/usr/local,PIDFile和ExecStart字段里
systemctl daemon-reload
/etc/init.d/keepalived start
```

## 配置
```
! Configuration File for keepalived

global_defs {
   notification_email {
		root@localhost
   }
   notification_email_from root@localhost
   smtp_server 127.0.0.1 
   smtp_connect_timeout 30
   router_id LVS_DEVEL
}

vrrp_instance VI_1 {
    state BACKUP
    interface em2
    virtual_router_id 51
    priority 60
    advert_int 2
    nopreempt
    authentication {
        auth_type PASS
        auth_pass 123456
    }
    virtual_ipaddress {
        172.18.5.101/24 dev em2
    }
}
virtual_server 172.18.5.101 80 {
    delay_loop 2
    lb_algo wrr 
    lb_kind DR
    persistence_timeout 60
    protocol TCP
    real_server 127.0.0.1 80 {
        weight 3
		notify_down /etc/keepalived/change_vip.sh
		TCP_CHECK {
		 connect_timeout 10
		 nb_get_retry 3
		 delay_before_retry 3
		 connect_port 80
		}
    }
}

notify_down是用来配置告警脚本的
```

> change_vip.sh
```
#!/bin/sh
pkill keepalived
#这里可以再写一些告警脚本
```
